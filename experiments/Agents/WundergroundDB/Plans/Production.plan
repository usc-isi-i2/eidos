PLAN Production
{
  INPUT:   text zip
  OUTPUT:   stream Production_output

  BODY
  {
    /* Generated by PlanGenerator 2.0.00 - 10/07/2008 15:12:22 PDT*/
    /* Plan Type: Main Plan, Batch*/
    
    /**********  Initialization **********/
    test_makexmlnode2("AgentInputValues",("zip",zip,"") : agentInputValues)
    test_initializeagentexecution4(agentInputValues : agentInputStream,agentMetadataStream)
    
    /**********  Retrieve Request Bindings **********/
    test_makeandstorerequestbindings("$Entry",("EntryConn1"),agentInputStream : agentInputStream2,err_makeandstorebindings_Entry)
    test_retrieverequestbindings(("$Entry.EntryConn1","Wrapper1.NewConnector1"),agentInputStream2 : err_retrievebindings,(Entry_EntryConn1_bindings,Wrapper1_NewConnector1_bindings))
    test_unionvar((err_makeandstorebindings_Entry,err_retrievebindings) : err_unfinished_Entry)
    test_dbwriteerror(err_unfinished_Entry : err_Entry)
    
    /**********  Request Entry_EntryConn1  **********/
    test_fetch("$Entry.EntryConn1",Entry_EntryConn1_bindings : Entry_EntryConn1_page_to_Wrapper1,err_fetch_Entry_EntryConn1)
    test_dbwriteerror(err_fetch_Entry_EntryConn1 : err_Entry_EntryConn1)
    
    /**********  Wrapper Wrapper1  **********/
    test_makeandstorerequestbindings("Wrapper1",("NewConnector1"),Entry_EntryConn1_page_to_Wrapper1 : Wrapper1_processedData,err_makeandstorebindings_Wrapper1)
    test_finishrequest(Wrapper1_processedData,"success" : Wrapper1_finishedData,err_validate_Wrapper1)
    test_unionvar((err_makeandstorebindings_Wrapper1) : err_unfinished_Wrapper1)
    test_dbwriteerror(err_unfinished_Wrapper1 : err_Wrapper1)
    
    /**********  Request Wrapper1_NewConnector1  **********/
    test_fetch("Wrapper1.NewConnector1",Wrapper1_NewConnector1_bindings : Wrapper1_NewConnector1_page_to_Wrapper2,err_fetch_Wrapper1_NewConnector1)
    test_dbwriteerror(err_fetch_Wrapper1_NewConnector1 : err_Wrapper1_NewConnector1)
    
    /**********  Wrapper Wrapper2  **********/
    test_extract("Wrapper2",Wrapper1_NewConnector1_page_to_Wrapper2 : Wrapper2_unvalidated_data,err_extract_Wrapper2)
    test_validate2(Wrapper2_unvalidated_data : Wrapper2_data,unused_1_Wrapper2)
    test_flatten2(Wrapper2_data,"union" : Wrapper2_flattened_data,err_flatten_Wrapper2)
    test_dbwritedata3("wundergrounddb_Wrapper2","*(8000)",Wrapper2_flattened_data : Wrapper2_writtenData,err_validate_Wrapper2,err_writedata_Wrapper2)
    test_unionvar((err_extract_Wrapper2,err_flatten_Wrapper2,err_writedata_Wrapper2) : err_unfinished_Wrapper2)
    test_dbwriteerror(err_unfinished_Wrapper2 : err_Wrapper2)
    
    /**********  Error Handling   **********/
    test_unionvar((err_Entry,err_Entry_EntryConn1,err_Wrapper1_NewConnector1,err_Wrapper1,err_Wrapper2) : errors)
    test_unionvar((err_validate_Wrapper1,err_validate_Wrapper2) : validation_errors)
    
    /**********  Convert data to XML   **********/
    test_generateplanoutput(agentMetadataStream : agentMetadataStream_xml)
    test_generateplanoutput(agentInputStream : agentInputStream_xml)
    test_generateplanoutput(errors : errors_xml)
    test_generateplanoutput(validation_errors : validation_errors_xml)
    
    /**********  Combine output streams  **********/
    test_unionvar((agentInputStream_xml,agentMetadataStream_xml,errors_xml,validation_errors_xml) : Production_output)
  }
}